{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load dict_get %}


{% block content %}

<!--Hero section-->
<section class="hero">
    <div class="hero-overlay px-3 px-md-4 px-lg-5 py-3 py-md-4 py-lg-5 mt-md-0 mx-auto">
        <h1 class="display-6 display-md-5 display-lg-4 mb-3 mb-md-4">Welcome to PetPicks!</h1>
        <p class="fs-6 fs-md-5 mb-3 mb-md-4">Your chance to win amazing prizes by sharing your beloved pets.</p>
        <ul class="mb-2">
            <li class="mb-2 fs-6">Enter your pet.</li>
            <li class="mb-2 fs-6">Win badges.</li>
            <li class="mb-2 fs-6">Have fun.</li>
        </ul>
        {% if user.is_authenticated %}
        <a href="{% url 'round_list' %}" class="btn btn-primary" id="joinNowBtn">View Active Rounds</a>
        {% else %}
        <a href="{% url 'account_signup' %}" class="btn btn-primary">Join Now</a>
        {% endif %}
    </div>
</section>

<!-- Recent Winners Section -->
<section class="container my-5 recent-winners">
    <h2 class="text-center mb-4">Recent Winning Pets</h2>

    {% if recent_winners %}
    <div class="row">
        {% for entry in recent_winners %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 recent-winner-card d-flex flex-column">
                {% if entry.photo %}
                <img src="{{ entry.photo.url }}" class="card-img-top winner-image" style="cursor: pointer;"
                    data-full-image="{{ entry.photo.url }}" alt="{{ entry.pet.name }} winning pet photo">
                {% else %}
                <div class="p-5 text-center text-muted">No photo available</div>
                {% endif %}
                <div class="card-body text-center">
                    <h2 class="card-title display-5">{{ entry.pet.name }}</h2>
                    <p class="small text-muted">{{ entry.round.title }}</p>
                </div>
                <div class="card-body pt-0 d-flex flex-column">
                    <div id="comments-section-{{ entry.id }}">
                        {% include "core/_comments_section.html" with entry=entry comment_page=entry.comment_page user=user %}
                    </div>

                    {% if user.is_authenticated %}
                    <form method="post" action="{% url 'comment_create' entry.id %}" class="comment-form">
                        {% csrf_token %}
                        {{ comment_forms|dict_get:entry.id|crispy }}
                        <button class="btn btn-primary" type="submit">Post</button>
                    </form>
                    {% else %}
                    <p class="text-muted mt-3 mb-0">Log in to post a comment.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-muted">No winners yet. Be the first to enter your pet!</p>
    {% endif %}
</section>

<!-- Contact Form Section -->
<section id="contact-form" class="container my-5">
    <h2 class=" mb-4 text-center">Contact PetPicks Team</h2>
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow contact-card">
                <div class="card-body p-4">
                    <form method="post" novalidate class="needs-validation" autocomplete="off">
                        {% csrf_token %}
                        {{ contact_form.non_field_errors }}
                        <div class="mb-3">
                            {{ contact_form.name|as_crispy_field }}
                            {% for error in contact_form.name.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ contact_form.email|as_crispy_field }}
                            {% for error in contact_form.email.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ contact_form.message|as_crispy_field }}
                            {% for error in contact_form.message.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <button type="submit" class="btn btn-primary w-100 py-2 fs-5">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="{% static 'js/home.js' %}"></script>

{% endblock %}